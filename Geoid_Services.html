<!DOCTYPE html>
<html>
  <head>
    <title>Basic Leaflet Map with GeoJSON and Layer control</title>
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""
    />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script
      src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
      integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
      crossorigin=""
    ></script>
    <!-- Adding the CND for JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>
  <body>
    <div id="map" style="width: 1350px; height: 600px"></div>

    <script>
      // Map creation
      var map = L.map("map").setView([-25.754544, 28.231482], 15);

      // basemaps and attributions

      osm_URL = "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";

      osmLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';

      var osm = L.tileLayer(osm_URL, {
        attribution: "&copy; " + osmLink + " Contributors",
      }).addTo(map);

      //Stadia tiles attribution and URL

      dark_URL = "http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png";

      var darkMap = L.tileLayer(dark_URL);

      // load data layers from geoserver
      var boundary = L.tileLayer
        .wms("http://geolive.co.za:8080/geoserver/geoid/wms", {
          layers: "geoid:Boundary",
          format: "image/png",
          transparent: true,
          attribution: "Awesome data © 2022 University of Pretoria",
        })
        .addTo(map);

      /*var bookstore = L.tileLayer.wms("http://geolive.co.za:8080/geoserver/geoid/wms", {
              layers: 'geoid:Bookstores',
              format: 'image/png',
              transparent: true,
              attribution: "Awesome data © 2022 University of Pretoria"
            }).addTo(map);

            var itserv = L.tileLayer.wms("http://geolive.co.za:8080/geoserver/geoid/wms", {
              layers: 'geoid:IT services',
              format: 'image/png',
              transparent: true,
              attribution: "Awesome data © 2022 University of Pretoria"
            }).addTo(map);*/

      // WFS
      // specify your root URL...
      var owsrootUrl = "http://geolive.co.za:8080/geoserver/geoid/ows";

      //CHUNK 1
      // Bookstores WFS
      // Defining bookstores parameters
      var defaultBookstore = {
        service: "WFS",
        version: "1.0.0",
        request: "GetFeature",
        typeName: "geoid:Bookstores",
        outputFormat: "text/javascript",
        format_options: "callback:getJsonBook",
        SrsName: "EPSG:4326",
      };

      var parameters_books = L.Util.extend(defaultBookstore);
      var URL_books = owsrootUrl + L.Util.getParamString(parameters_books);

      // Create an empty layer
      var bookstoreLayer = null;

      // this is the ajax request, we are using the jsonp option
      var ajax_books = $.ajax({
        url: URL_books,
        dataType: "jsonp",
        jsonpCallback: "getJsonBook",

        //In the event of success...
        success: function (response) {
          bookstoreLayer = L.geoJson(response, {
            pointToLayer: function (feature, latlng) {
              var bookIcon = L.icon({
                iconSize: [35, 35],
                iconAnchor: [13, 27],
                popupAnchor: [1, -24],
                iconUrl: "bookstore.png",
              });

              return L.marker(latlng, { icon: bookIcon });
            },
            onEachFeature: function (feature, featureLayer) {
              featureLayer.bindTooltip(feature.properties.name);

              const popupInfo = `
                                    <b>Contact: </b> ${feature.properties.contact} <br>
                                    <b>Website: </b> ${feature.properties.website}
                                  `;
              featureLayer.bindPopup(popupInfo);
            },
          }).addTo(map);
          layerControl.addOverlay(bookstoreLayer, "Books");
        },
      });

      //CHUNK 2
      // IT services WFS
      // Defining IT services parameters
      var defaultItserv = {
        service: "WFS",
        version: "1.0.0",
        request: "GetFeature",
        typeName: "geoid:IT_services",
        outputFormat: "text/javascript",
        format_options: "callback:getJsonIT",
        SrsName: "EPSG:4326",
      };

      var parameters_it = L.Util.extend(defaultItserv);
      var URL_it = owsrootUrl + L.Util.getParamString(parameters_it);

      // Create an empty layer
      var ITLayer = null;

      // this is the ajax request, we are using the jsonp option
      var ajax_it = $.ajax({
        url: URL_it,
        dataType: "jsonp",
        jsonpCallback: "getJsonIT",

        //In the event of success...
        success: function (response) {
          ITLayer = L.geoJson(response, {
            pointToLayer: function (feature, latlng) {
              var itIcon = L.icon({
                iconSize: [35, 35],
                iconAnchor: [13, 27],
                popupAnchor: [1, -24],
                iconUrl: "motherboard.png",
              });

              return L.marker(latlng, { icon: itIcon });
            },
            onEachFeature: function (feature, featureLayer) {
              featureLayer.bindTooltip(feature.properties.name);

              const popupInfo = `
                                    <b>Contact: </b> ${feature.properties.contact} <br>
                                    <b>Website: </b> ${feature.properties.website}
                                  `;
              featureLayer.bindPopup(popupInfo);
            },
          }).addTo(map);
          layerControl.addOverlay(ITLayer, "IT");
        },
      });

      //CHUNK 3
      // Create a layer control
      // define basemaps

      var baseMaps = {
        BaseMap: osm,
        Dark: darkMap,
      };
      //
      var overlays = {
        Boundary: boundary,
      };

      var layerControl = L.control.layers(baseMaps).addTo(map);
    </script>
  </body>
</html>
